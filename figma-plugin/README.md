# Open H2D Figma Plugin

A Figma plugin that imports ZIP files generated by the Open H2D Chrome extension, reconstructing web pages with pixel-perfect fidelity in Figma.

## Features

### ✅ ZIP Import & Validation
- **Drag & Drop Interface**: Simply drag ZIP files onto the plugin interface
- **Comprehensive Validation**: Validates ZIP structure, manifest format, and data integrity
- **Real-time Feedback**: Visual validation with checkmarks and error messages
- **Progress Indicators**: Step-by-step progress during import process

### ✅ CSS-to-Figma Conversion
- **Color Conversion**: Supports hex, RGB, RGBA, and named colors
- **Typography**: Font family, size, weight, and alignment conversion
- **Layout Properties**: Padding, margins, border-radius, and positioning
- **Visual Effects**: Box shadows with proper blur, spread, and offset
- **Opacity & Z-index**: Layer opacity and stacking order

### ✅ Layout Reconstruction
- **Element Hierarchy**: Recreates proper parent-child relationships
- **Pixel-Perfect Positioning**: Maintains exact coordinates and dimensions
- **Auto-Layout Support**: Optionally uses Figma's auto-layout for containers
- **Text Preservation**: Maintains all text content with proper styling
- **Image Handling**: Imports images from ZIP assets or creates placeholders

### ✅ Advanced Settings
- **Pixel-Perfect Mode**: Prioritizes fidelity over performance
- **Auto-Layout Detection**: Intelligently applies auto-layout to containers  
- **Element Grouping**: Optional grouping of similar elements
- **Error Recovery**: Graceful handling of missing assets or invalid data

## Supported Elements

The plugin can import and convert the following HTML elements:

| Element | Figma Conversion | Features |
|---------|------------------|----------|
| `<div>` | Frame/Rectangle | Background, border-radius, padding, shadows |
| `<p>`, `<h1>`-`<h6>` | Text Layer | Font styling, color, alignment, sizing |
| `<span>` | Text Layer | Inline text with full typography support |
| `<img>` | Rectangle with Image Fill | Asset loading from ZIP or placeholder |
| `<button>` | Frame + Text | Container with styled text content |
| `<a>` | Text/Frame | Links converted based on content type |

## Installation

### For Figma Desktop
1. Open Figma Desktop application
2. Go to **Plugins** → **Development** → **Import plugin from manifest**
3. Select the `manifest.json` file in the `figma-plugin` directory
4. The plugin will appear in your plugins list

### For Figma Web (Development)
1. Open Figma in your browser
2. Go to **Plugins** → **Development** → **New plugin**
3. Choose **Import plugin from manifest**
4. Upload the plugin files

## Usage

### 1. Export from Chrome Extension
- Use the Open H2D Chrome extension to capture any webpage
- Download the generated ZIP file (e.g., `page-20240101_120000.zip`)

### 2. Import to Figma
1. Open the "Open H2D Importer" plugin in Figma
2. **Drag and drop** the ZIP file onto the plugin interface, or click to browse
3. Wait for **validation** to complete (green checkmarks indicate success)
4. Adjust **import settings** if desired:
   - ✅ **Pixel-perfect mode**: Maximum fidelity
   - ✅ **Use auto-layout**: Smart container layout
   - ⬜ **Group similar elements**: Automatic element grouping
5. Click **"Import Page"** to start the reconstruction
6. Monitor the **progress bar** during import
7. The imported page will appear on your current Figma canvas

### 3. Review Results
- All elements are positioned exactly as they appeared in the browser
- Text content is preserved with original styling
- Images are embedded (when possible) or show as placeholders
- The root frame contains the entire page layout

## ZIP File Structure

The plugin expects ZIP files with this structure:

```
page-{timestamp}.zip/
├── manifest.json          # Format metadata
├── data.json             # Page elements and styling data  
└── assets/
    └── images/
        ├── image1.png    # Binary image files
        └── image2.jpg
```

### manifest.json Format
```json
{
  "format": "zip-pack",
  "version": "1.0", 
  "created": "2024-01-01T12:00:00.000Z",
  "source": {
    "title": "Page Title",
    "url": "https://example.com"
  }
}
```

### data.json Format
```json
{
  "version": "1.0",
  "title": "Page Title",
  "url": "https://example.com", 
  "viewport": { "width": 1920, "height": 1080 },
  "elements": [
    {
      "tag": "div",
      "text": "Hello World",
      "x": 100, "y": 50, "width": 200, "height": 30,
      "color": "#333333",
      "backgroundColor": "#ffffff", 
      "fontSize": "16px",
      "fontFamily": "Arial",
      "padding": { "top": "8px", "right": "12px", "bottom": "8px", "left": "12px" },
      "borderRadius": "4px"
    }
  ],
  "assets": {
    "img/photo.jpg": {
      "filename": "assets/images/photo.jpg",
      "originalUrl": "https://example.com/photo.jpg",
      "type": "image"
    }
  }
}
```

## Error Handling

The plugin includes comprehensive error handling for common issues:

### Validation Errors
- **Missing Files**: `manifest.json` or `data.json` not found
- **Invalid Format**: Wrong manifest format or corrupted JSON
- **Empty Data**: Missing elements array or invalid structure

### Import Errors  
- **Font Loading**: Fallback to Inter font when custom fonts unavailable
- **Image Loading**: Placeholder rectangles for missing/corrupted images
- **Invalid CSS**: Graceful degradation for unsupported CSS properties
- **Large Files**: Progress indicators and memory-efficient processing

### Recovery Options
- **Partial Import**: Continue processing remaining elements if some fail  
- **Asset Fallbacks**: URL references when binary assets unavailable
- **Style Defaults**: Sensible defaults for missing CSS properties

## Technical Details

### Dependencies
- **fflate**: ZIP file parsing (loaded from CDN)
- **Figma Plugin API**: For creating and manipulating Figma nodes
- No additional external dependencies

### Performance Optimizations
- **Chunked Processing**: Elements processed in batches to prevent UI blocking
- **Progress Updates**: Real-time feedback every 10 elements  
- **Memory Management**: Efficient handling of large ZIP files and assets
- **Error Boundaries**: Individual element errors don't stop entire import

### Browser Compatibility
- Works in Figma Desktop (all platforms)
- Compatible with Figma Web (Chrome, Firefox, Safari)
- Tested with ZIP files from Chrome extension on all major browsers

## Troubleshooting

### "Validation Failed" Errors
- **Check ZIP Structure**: Ensure `manifest.json` and `data.json` exist
- **Verify Format**: Manifest should have `"format": "zip-pack"`
- **Test with Smaller Files**: Try with a simple page first

### "Import Failed" Errors
- **Memory Issues**: Try with smaller pages or restart Figma
- **Font Problems**: Check if custom fonts are available in Figma
- **Network Issues**: Ensure stable internet for font loading

### Missing Images
- **CORS Restrictions**: Some images can't be captured by the browser extension
- **Large Files**: Very large images may not be included in ZIP
- **Format Support**: Only PNG/JPG images are fully supported

### Layout Issues
- **Complex CSS**: Some advanced CSS features may not translate perfectly
- **Responsive Design**: Plugin captures the specific viewport state only
- **Dynamic Content**: JavaScript-generated content may not be captured

## Development

To modify or extend the plugin:

### File Structure
```
figma-plugin/
├── manifest.json         # Plugin configuration
├── code.js              # Main plugin logic
└── ui.html              # User interface
```

### Key Classes
- **`CSSConverter`**: Handles CSS-to-Figma property conversion
- **`LayoutEngine`**: Manages element creation and layout reconstruction
- **Main Handler**: Orchestrates the import process with progress updates

### Extension Points
- Add new CSS property conversions in `CSSConverter`
- Extend element type support in `LayoutEngine.createElement()`
- Modify layout algorithms in `LayoutEngine.reconstructLayout()`
- Enhance validation in the UI's `validateZipStructure()` function

## License

Part of the Open H2D project. See main project repository for license details.

## Support

For issues, feature requests, or contributions:
1. Check the main Open H2D project documentation
2. Review the browser extension compatibility
3. Test with known-good ZIP files first
4. Report issues with specific error messages and ZIP file details